# === ACTIVADORES ===
ENABLE_RANGE=1
ENABLE_TREND=1
ENABLE_SCALP_C=1
ENABLE_FAILSAFE=1

# === FEES / EDGE (ajusta tu fee real) ===
FEE_PCT_PER_SIDE=0.0010           # 0.10% por lado
SCALP_COLCHON_PCT=0.0005          # 5 bps extras sobre 2*fee

# === BANDAS POR MÓDULO (más anchas) ===
RANGE_SPREAD_MIN_PCT=0.0003       # 3 bps (se ignora si no hay edge)
RANGE_SPREAD_MAX_PCT=0.0060       # 0.60%
TREND_SPREAD_MIN_PCT=0.0002       # 2 bps
TREND_SPREAD_MAX_PCT=0.0035       # 0.35%
SPREAD_EPS_PCT=0.00003            # 3 bps de tolerancia

# === MICRO / IMPULSO ===
MICRO_SCORE_SOFT=0.25
MICRO_SCORE_HARD=0.45
IMP_RET_LOOKBACK_SEC=3
IMP_RET_BBW=0.20                   # entra si |ret_3s| >= 0.20 * BBW

# === SLOPE / ADX (relajados) ===
ADX_MIN_TREND=20
SLOPE_WARN=800.0
SLOPE_HARD=1200.0

# === QUOTING / RISK ===
ORDER_TTL_SEC=5                    # cancela y refresca (Profile B: more frequent refresh)
RELIST_DELAY_SEC=0.4
QUOTE_TOP_K=2
MAX_ACTIVE_PAIRS=2
FAILSAFE_QUOTE_AFTER_SEC=90
FAILSAFE_SPREAD_PCT=0.0030         # 0.30%
FAILSAFE_COLCHON_PCT=0.0005
# ================== CLAVES / ENDPOINT / ZONA HORARIA ==================
BINANCE_API_KEY=FdRUWIvnIF7Dxuy3FtghrfpZ7sw3oLu6AYdfcyeUEOSOgYH6Xz9aGcjw8uYd4el8
BINANCE_API_SECRET=zhdvMGMy267YiCUqkwkWE9ju3X0tkrzFil1yBhe35RonblTMLdkZY0VfEW8zL9R6
EXCHANGE=binance_futures
BINANCE_FUT_BASE=https://testnet.binancefuture.com
TIMEZONE=America/Merida

# ================== CONFIGURACIÓN SCALPER BOT (PSAR) ==================
# Tamaño de posición por operación en USDT (aplicado a todos los pares)
TRADE_NOTIONAL_USDT=70.0
MIN_TRADE_NOTIONAL_USDT=70.0
MAX_NOTIONAL_USDT=70.0
BINANCE_API_MODE=testnet

# === PROTECCIÓN CONTRA COMISIONES ===
# Asegura que el TP siempre cubra comisiones + edge mínimo
FEE_ROUNDTRIP_PCT=0.0010      # 0.10% ida+vuelta (maker 0.02% + taker 0.08% aprox)
EDGE_MIN_PCT=0.0020           # 0.20% mínimo de ganancia neta después de fees
SL_MIN_PCT=0.0040             # 0.40% SL mínimo para evitar ruido
BASE_RRR=1.30                 # Risk-Reward Ratio base: TP ≈ SL * 1.3
SL_ATR5_MULT=1.0              # Multiplicador del ATR5m para calcular SL

# =========================== SÍMBOLOS ===========================
SYMBOLS=SOLUSDT,XRPUSDT,BNBUSDT,DOGEUSDT,NEOUSDT,AVAXUSDT,ADAUSDT

# ======================== VENTANAS / SYNC =======================
RECV_WINDOW=60000
TIME_SYNC_SEC=120

# ========================= TIMINGS BOT ==========================
SCAN_SLEEP_SEC=0.30
COOLDOWN_SEC=1.2                    # reduced to allow faster re-entry after exit
POST_ENTRY_SLEEP_SEC=0.15           # faster post-entry cycle to resume scanning earlier
ATR_REFRESH_SEC=25

# ====================== CUENTA / LÍMITES ========================
EQUITY_USDT=100
USE_EXCHANGE_EQUITY=0
ACCOUNT_USD_BUDGET=100
PER_TRADE_CAP_USD=12
MARGIN_HEADROOM_PCT=0.10
MAX_OPEN_POSITIONS=3
MAX_SIMULTANEOUS_POS=3
DAILY_LOSS_LIMIT_USDT=0.0
DAILY_LOSS_LIMIT_PCT=0.035
SESSION_LOSSES_LIMIT=3
SESSION_WINDOW_MIN=20
SESSION_COOLDOWN_MIN=15
SIZE_ROUNDING_SAFE=1e-12

# ================== APALANCAMIENTO / NOTIONAL ===================
LEVERAGE_A=10
LEVERAGE_B=10
LEVERAGE_C=10
LEVERAGE_DEFAULT=10
LEVERAGE_MIN=3
LEVERAGE_MAX=12
AUTO_LEVERAGE=1
POSITION_NOTIONAL_FRACTION=0.20
MAX_NOTIONAL_PER_TRADE_USDT=160
MARGIN_FRACTION_CAP=0.70

# ============================ RIESGO ============================
RISK_PER_TRADE_USDT=0.40
RISK_PER_TRADE_PCT=0.006
RISK_SCALE_A=1.00
RISK_SCALE_B=1.00
RISK_SCALE_C=0.85
RISK_MULT_TREND=1.10
RISK_MULT_RANGE=0.98
RISK_MULT_WICKS=0.85

# ========================= SCALP 1m =========================
SCALP_ENABLED=1
SCALP_EMA_FAST=9
SCALP_EMA_SLOW=21
SCALP_ATR_PERIOD=14
SCALP_SL_ATR_MULT=1.0
SCALP_TP_ATR_MULT=1.8
SCALP_MAX_CONCURRENT=3
SCALP_MAX_HOLD_MINUTES=8
SCALP_RISK_PCT=0.003

# ========================= HTF (Opcional) =======================
HTF_TREND_FILTER=0
HTF_ALIGN_RISK_BOOST=1.10
HTF_CONTRA_RISK_CUT=0.80

ALIGN_B_REQUIRED=0

# ===================== COSTES / MICRO ESTRUCTURA =================
MAKER_FEE_PCT=0.00018
TAKER_FEE_PCT=0.00045
SPREAD_MAX_PCT=0.0025           # 25 bps (default)
SPREAD_MIN_PCT=0.00005          # 0.5 bps default
STOP_MIN_GAP_PCT=0.0003
SPREAD_SLIPPAGE_MULT=0.55
IOC_SLIP_PCT=0.0010
STOP_BUFFER_PCT=0.0002
# Tolera “al borde” para no quedar fuera por 0.5 bps:
SPREAD_MAX_EPS_PCT=0.000005

# ======================= INDICADORES / TF =======================
ATR_PERIOD=14
RSI_PERIOD=14
EMA_FAST_B=9
EMA_SLOW_B=21
EMA_TREND=50
ADX_PERIOD=14
TF_A=1m
TF_B=5m
TF_C=1m

# =================== RÉGIMEN / HISTERESIS ======================
BB_PERIOD=20
BB_DEV=2.0
BB_SQUEEZE_PCT=0.0095
EMA_SLOPE_TICKS_TREND=0.8
ADX_TREND_MIN=20
ADX_RANGE_MAX=32
REGIME_HYST_BARS=3

# ======================= SCORES MÍNIMOS =========================
MIN_SCORE_A=0.52
MIN_SCORE_B=1.25
MIN_SCORE_C=0.80
MIN_RR_B=1.90

# =================== RITMO DE ENTRADAS =========================
MIN_SECS_BETWEEN_TRADES_PER_SYMBOL=8   # allow quicker re-entries per symbol
SYMBOL_LOSS_COOLDOWN_SEC=120
MAX_TRADES_PER_HOUR=9999

# ===================== MÓDULO A (RANGE) ========================
# Relajar clamp de pendiente para evitar falsos negativos (testnet escala slope alta)
SLOPE_ABS_MAX_A=400.0
TAKE_PROFIT_PCT_BASE_A=0.0022
STOP_LOSS_PCT_BASE_A=0.00075
TIME_STOP_SEC_A=720
TP1_PARTIAL_QTY_FRAC_A=0.50
TP1_EXTRA_EDGE_A=0.00030
MAKER_ONLY_A=1
A_SPREAD_BAND_MIN=0.00010
A_SPREAD_BAND_MAX=0.00850
A_SLOPET_MIN=0.0

# ==================== MÓDULO B (TREND) =========================
RR_TARGET_B=2.0
ATR_SL_MULT_B=0.85
ATR_TRAIL_MULT_B=0.35
ALLOW_TAKER_B=1
MOVE_SL_TO_BE_AT_R_B=0.4
TRAIL_START_R_B=1.0
BE_BUFFER_BPS=2
B_TAKER_ONLY_ADX_MIN=20
B_TAKER_ONLY_ADX_MAX=55
B_MAKER_ON_EXTREMES=1

# Module B tuning for Profile B
SPREAD_ATR_RATIO_MAX_B=0.35
SLIPPAGE_CAP_BPS_TAKER=8.0

# ========== MICROFLOW / ORDER-FLOW GATING (global) ===========
MICRO_IMBALANCE_MIN=0.30
DELTA_BPS_MIN=6
MICRO_RELAX_ADX=25
MICRO_IMBALANCE_MIN_RELAX=0.25
DELTA_BPS_MIN_RELAX=5
MICRO_BLOCK_SEC=8
# Bypass de micro-gate si la tendencia ya es fuerte (tus logs muestran ADX≈29):
MICRO_DISABLE_ABOVE_ADX=45
ADX_GATE_B_MAX=70

# --- Micro regime switch (mercado seco) ---
ENABLE_MICRO_MODE=1
DRY_ADX_MAX=6.0
DRY_BBW_MAX=0.010

# --- Parámetros A (RANGE) normales ---
ADX_MIN_A=7.0
BBW_MIN_A=0.0035

# --- Parámetros A en MICRO ---
MIN_SCORE_A_MICRO=0.50
ADX_MIN_A_MICRO=0.0
SPREAD_MIN_PCT_MICRO=0.00003
SPREAD_MAX_PCT_MICRO=0.004


# ========================= CORRELACIÓN =========================
CORR_WINDOW=40
CORR_THRESHOLD=0.80
CORR_LEVEL_2=0.90
CORR_REDUCE_1=0.5
CORR_REDUCE_2=0.25

# ========== TAMAÑOS BASE (notional por símbolo) ================
ORDER_NOTIONAL_USDT_ETH=22   # cumple minNotional≈20 testnet
ORDER_NOTIONAL_USDT_SOL=7
ORDER_NOTIONAL_USDT_XRP=7
ORDER_NOTIONAL_USDT_DOGE=7
ORDER_NOTIONAL_USDT_AVAX=7
ORDER_NOTIONAL_USDT_NEAR=7
ORDER_NOTIONAL_USDT_AXS=7

# ======== MICRO A POR SÍMBOLO (OFI/SLOPE existentes) ==========
# Relaja OFI de ETH para no bloquear por falta de OFI neto en RANGE.
ETHUSDT_OFI_MIN_A=0.05       # antes 0.12
SOLUSDT_OFI_MIN_A=0.22
XRPUSDT_OFI_MIN_A=0.18
DOGEUSDT_OFI_MIN_A=0.20
AVAXUSDT_OFI_MIN_A=0.20
NEARUSDT_OFI_MIN_A=0.20
AXSUSDT_OFI_MIN_A=0.22

ETHUSDT_SLOPE_TICKS_MIN_A=0.50
SOLUSDT_SLOPE_TICKS_MIN_A=0.72
XRPUSDT_SLOPE_TICKS_MIN_A=0.86
DOGEUSDT_SLOPE_TICKS_MIN_A=1.00
AVAXUSDT_SLOPE_TICKS_MIN_A=0.78
NEARUSDT_SLOPE_TICKS_MIN_A=0.82
AXSUSDT_SLOPE_TICKS_MIN_A=0.90

# ===================== WICKS POR SÍMBOLO =======================
WICK_ATR_K_ETHUSDT=1.55
WICK_ATR_K_SOLUSDT=1.90
WICK_ATR_K_XRPUSDT=1.80
WICK_ATR_K_DOGEUSDT=1.90
WICK_ATR_K_AVAXUSDT=1.85
WICK_ATR_K_NEARUSDT=1.80
WICK_ATR_K_AXSUSDT=1.85

# ================ UMBRALES POR PAR (CLAVE) =====================
SPREAD_MIN_PCT_ETHUSDT=0.000002
ATR_MIN_BPS_ETHUSDT=8
BBW_MIN_ETHUSDT=0.0011

SPREAD_MIN_PCT_SOLUSDT=0.00010
ATR_MIN_BPS_SOLUSDT=7
BBW_MIN_SOLUSDT=0.0018
# Testnet muestra spreads 0.5%–0.53% => ampliar banda alta para no bloquear por banda (EV sigue mandando)
SPREAD_MAX_PCT_SOLUSDT=0.0060

SPREAD_MIN_PCT_XRPUSDT=0.00010
SPREAD_MAX_PCT_XRPUSDT=0.0030
ATR_MIN_BPS_XRPUSDT=6.5
BBW_MIN_XRPUSDT=0.0016

SPREAD_MIN_PCT_DOGEUSDT=0.00010
SPREAD_MAX_PCT_DOGEUSDT=0.0032
ATR_MIN_BPS_DOGEUSDT=6
BBW_MIN_DOGEUSDT=0.0018

SPREAD_MIN_PCT_AVAXUSDT=0.00015
ATR_MIN_BPS_AVAXUSDT=7.5
BBW_MIN_AVAXUSDT=0.0020
# Testnet AVAX 0.75%–0.80%
SPREAD_MAX_PCT_AVAXUSDT=0.0085

# Nuevos pares (liquidez media)
SPREAD_MIN_PCT_NEARUSDT=0.00015
SPREAD_MAX_PCT_NEARUSDT=0.0060
SPREAD_MIN_PCT_AXSUSDT=0.00020
SPREAD_MAX_PCT_AXSUSDT=0.0065

# =========== ECONÓMICO + TP DINÁMICO (EDGE REAL) ===============
ENFORCE_ECON=1
EDGE_MIN_BPS=6.0
TP_DYNAMIC_EN=1
K1_SPREAD=2.0
K2_ATR_RNG=0.55
TP_MIN_BPS=10
TP_MAX_BPS=25
TP_LIMITS_BPS=10,30
ATR_SCALE_BY_BBW=1
BBW_REF=0.012
SOFT_MARGIN_BPS=2.0
# (El EV manda: si spread es gigante, la regla exigirá TP gigante y NO entrará → protección de PnL)

# --- Econ en MICRO (más permisivo, pero aún positivo) ---
TP_MIN_BPS_MICRO=8
TP_MAX_BPS_MICRO=18
K1_SPREAD_MICRO=1.8
K2_ATR_RNG_MICRO=0.35
EDGE_MIN_BPS_MICRO=3.0         # Úsalo SOLO si tu maker fee <= 1.5 bps. Si es 1.8 bps, pon 2.0 aquí.

# =============== VOLATILIDAD MÍNIMA (DURO) =====================
VOL_ENFORCE=1
MIN_ATR_BPS=9.5
ATR_MIN_BPS=9.5
BBW_MIN=0.0020
VOL_MIN_ATR_PCT_A=0.00030
VOL_SPREAD_ATR_MAX_RATIO_A=0.60
ALLOW_LOW_VOL=0

# ===================== ADVISOR (CLIENTE) =======================
ADVISOR_ENABLED=1
ADVISOR_URL=http://127.0.0.1:8088/advice
ADVISOR_SHARED_SECRET=change-me
ADV_SHARED_SECRET=change-me
ADVISOR_AUTH_TOKEN=change-me
ADVISOR_TIMEOUT_MS=1500
ADVISOR_ENFORCE_DECISIONS=0
ADVISOR_APPLY_SCORE=1
ADVISOR_APPLY_RISK=1
ADVISOR_APPLY_MANAGEMENT=1
ADVISOR_LOG_VERBOSE=1
ADVISOR_CLIENT_LOG_LEVEL=INFO
ADVISOR_SOFT_REJECT_TO_NOTE=1

# ============== ADVISOR (SERVER TUNING OPCIONAL) ===============
ADV_P_MIN=0.58
ADV_SPREAD_MAX_BPS=90
ADV_EDGE_MIN_BPS=25
ADV_FEE_BPS=12
ADV_CUSHION_BPS=10
ADV_RISK_CAP_MAX=1.25
ADV_RISK_CAP_MIN=0.35
ADV_ADX_BOOST=0.35
ADV_CONF_BOOST=0.50
ADV_SL_ATR_MULT=1.8
ADV_TP_RR=1.4
ADV_TRAIL_AT_R=0.8
ADV_TO_BE_AT_R=0.6
ADVISOR_LOG_LEVEL=INFO
ADV_BBW_MIN_A=0.0005
ADV_MIN_SCORE_A=0.55
ADV_SPREAD_MAX_PCT=0.0025

# ================= PROFUNDIDAD / OBI (opcional) ================
USE_DEPTH_OBI=0
DEPTH_LIMIT=10
DEPTH_CONFIRM_SNAPSHOTS=1

# ========================== TUNER ===============================
TUNER_ENABLED=1
TUNER_WARMUP_TRADES_PER_SYM=8
TUNER_UPDATE_EVERY_TRADES=5
TUNER_STATE_PATH=tuner_state.json

# ======================= MAKER QUEUE ============================
MAKER_QUEUE_TOUCH_BPS=0.30
MAKER_QUEUE_CANCEL_AWAY_BPS=0.70
CANCEL_IF_AWAY_BPS=0.90
MAKER_ORDER_STALE_SEC=20

# ===================== EJECUCIÓN / MODO =========================
DRY_RUN=0
PLACE_ORDERS=1
POST_ONLY=1
TP_KIND=TAKE_PROFIT_MARKET
SL_KIND=STOP_MARKET
ENTRY_MIN_NOTIONAL_FLOOR_USDT=5.5
PROTECT_WORKING_TYPE_MARK=1
KILL_SWITCH_ON_EXCHANGE_ERROR=1

# ================== ÁRBITRO DE DECISIONES (NEW) =================
DECISION_COALESCE_MS=350
LOCK_MS_AFTER_ENTRY=500
LOCK_MS_AFTER_CANCEL=300
FLIP_HYST_BPS=6.0
MIN_HOLD_SECS=4                        # reduce min hold to exit faster on futures
ONLY_ONE_ENTRY_PER_SYM=1
REDUCE_ONLY_ON_FLIP=1
REPRICE_AWAY_BPS=0.8
REPRICE_AWAY_BPS=0.5                   # tighter reprice to grab back into top
QUOTE_LIFETIME_MS=2500                 # faster quote lifetime for aggressive re-quoting

# ===================== TELEMETRÍA / LOGS ========================
LOG_LEVEL=INFO
NO_TRADE_LOG=1
NO_TRADE_STATS_SEC=60
LOG_ORDER_CYCLE=1
LOG_FILL_LATENCY=1
LOG_EDGE_DETAIL=1
LOG_KPIS_SEC=300
# Debug económico extra para justificar en Git:
LOG_ECON_DETAIL=1
